<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Quest Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* --- æ¨£å¼å€ (CSS) --- */
        :root {
            --bg-color: #f4f5f7;
            --card-bg: #ffffff;
            --text-main: #333;
            --primary: #4f2a93; /* Habitica ç´«è‰² */
            --accent: #ffbe5c;  /* æŒ‘æˆ°å°ˆç”¨é‡‘è‰² */
            --danger: #ff6b6b;
            --success: #4caf50;
            --border-radius: 8px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            padding: 20px;
            margin: 0;
        }

        .container {
            width: 100%;
            max-width: 600px;
        }

        header {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        h1 { margin: 0 0 15px 0; font-size: 1.5rem; text-align: center; color: var(--primary); }

        /* é€²åº¦æ¢å€åŸŸ */
        .stats-panel {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .challenge-status {
            width: 100%;
        }

        .status-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .progress-bg {
            background: #e0e0e0;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            background: var(--success);
            height: 100%;
            width: 0%;
            transition: width 0.4s ease, background-color 0.3s;
        }

        .action-area {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn {
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: opacity 0.2s, transform 0.1s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn:active { transform: scale(0.98); }
        .btn:hover { opacity: 0.9; }
        .primary-btn { background: var(--primary); color: white; box-shadow: 0 2px 4px rgba(79, 42, 147, 0.3); }
        .secondary-btn { background: #e0e0e0; color: #333; }
        .delete-btn { background: none; color: #ccc; padding: 5px; }
        .delete-btn:hover { color: var(--danger); }

        /* ä»»å‹™åˆ—è¡¨ */
        .task-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .task-item {
            background: var(--card-bg);
            margin-bottom: 10px;
            padding: 15px;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            transition: all 0.2s;
            border-left: 5px solid transparent; /* é ç•™é‚Šæ¡†ä½ç½® */
        }

        /* ğŸŒŸ æŒ‘æˆ°ä»»å‹™æ¨£å¼ */
        .task-item.is-challenge {
            border-left: 5px solid var(--accent);
            background: #fffdf5;
        }

        .task-item.completed {
            opacity: 0.6;
            background: #f9f9f9;
        }
        .task-item.completed span {
            text-decoration: line-through;
            color: #888;
        }

        .task-content { flex-grow: 1; margin-left: 12px; }
        
        .tag {
            font-size: 0.7rem;
            background: #eee;
            padding: 2px 6px;
            border-radius: 4px;
            color: #666;
            margin-right: 6px;
            vertical-align: middle;
        }

        /* è¼¸å…¥æ¡†å€åŸŸ */
        .input-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            background: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .input-group input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            outline: none;
        }
        .input-group input:focus { border-color: var(--primary); }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #888;
        }
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #ddd;
        }

        /* Modal (å½ˆå‡ºè¦–çª—) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(2px);
        }
        .modal {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .modal-header h2 { margin: 0; color: var(--primary); }
        .close-btn {
            background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #888;
        }
        
        /* æŒ‘æˆ°å¡ç‰‡ */
        .challenge-card {
            border: 1px solid #eee;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .challenge-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            border-color: var(--accent);
        }
        .challenge-card h4 { margin: 0 0 5px 0; color: var(--text-main); font-size: 1.1rem; }
        .challenge-desc { font-size: 0.9rem; color: #666; margin-bottom: 10px; }
        .challenge-meta { font-size: 0.8rem; color: #999; display: flex; align-items: center; gap: 5px; }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1><i class="fas fa-dungeon"></i> Life Quest Dashboard</h1>
            
            <div class="stats-panel">
                <div class="challenge-status">
                    <div class="status-header">
                        <span id="challenge-label">æŒ‘æˆ°é€²åº¦</span>
                        <span id="challenge-percent">0%</span>
                    </div>
                    <div class="progress-bg">
                        <div id="challenge-progress-bar" class="progress-fill"></div>
                    </div>
                </div>
                
                <div class="action-area">
                    <button id="open-market-btn" class="btn primary-btn">
                        <i class="fas fa-scroll"></i> æ¥å—æ–°æŒ‘æˆ°
                    </button>
                </div>
            </div>
        </header>

        <main>
            <ul id="task-list" class="task-list">
                </ul>
            
            <div id="empty-state" class="empty-state" style="display:none;">
                <i class="fas fa-clipboard-check"></i>
                <p>ç›®å‰æ²’æœ‰ä»»å‹™ï¼Œå»æ¥å€‹æŒ‘æˆ°æˆ–æ˜¯æ–°å¢ä¸€é …å§ï¼</p>
            </div>
        </main>

        <div class="input-group">
            <input type="text" id="new-task-input" placeholder="è¼¸å…¥é›œé …ä»»å‹™åç¨±..." onkeypress="handleEnter(event)">
            <button onclick="addManualTask()" class="btn secondary-btn">
                <i class="fas fa-plus"></i> æ–°å¢
            </button>
        </div>
    </div>

    <div id="modal-overlay" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2>ğŸ›¡ï¸ æŒ‘æˆ°å¸‚é›†</h2>
                <button onclick="closeModal()" class="close-btn">&times;</button>
            </div>
            <div id="challenge-list" class="modal-body">
                </div>
        </div>
    </div>

    <script>
        /* --- ç¨‹å¼é‚è¼¯å€ (JavaScript) --- */

        // 1. å®šç¾©ä½ çš„æŒ‘æˆ° (å¯ä»¥åœ¨é€™è£¡è‡ªç”±æ–°å¢)
        const challenges = [
            {
                id: "code-refactor",
                title: "ğŸ§¹ Clean Code é€±æœ«",
                description: "é‚„æ¸…æŠ€è¡“å‚µï¼Œè®“ç¨‹å¼ç¢¼é–ƒé–ƒç™¼å…‰",
                tasks: [
                    { text: "ç§»é™¤æœªä½¿ç”¨çš„ import", tag: "Refactor" },
                    { text: "å°‡ >50 è¡Œçš„å‡½å¼æ‹†åˆ†", tag: "Refactor" },
                    { text: "ç‚ºæ ¸å¿ƒæ¨¡çµ„è£œä¸Šè¨»è§£", tag: "Docs" },
                    { text: "é–±è®€ 1 ç«  Clean Code", tag: "Study" }
                ]
            },
            {
                id: "workout-week",
                title: "ğŸ’ª æ–¯å·´é”å¥èº«é€±",
                description: "ä¸éœ€è¦å¥èº«æˆ¿ï¼Œåœ¨å®¶ä¹Ÿèƒ½è®Šå¼·",
                tasks: [
                    { text: "ä¼åœ°æŒºèº« 20 ä¸‹", tag: "Body" },
                    { text: "æ·±è¹² 30 ä¸‹", tag: "Legs" },
                    { text: "å¹³æ¿æ”¯æ’ 1 åˆ†é˜", tag: "Core" },
                    { text: "å–æ°´ 2500cc", tag: "Health" }
                ]
            },
            {
                id: "maple-boss",
                title: "ğŸ„ æ¥“ä¹‹è°·æ”»ç•¥çµ„",
                description: "ç‚ºäº†æ“Šæ•—é»‘é­”æ³•å¸«åšæº–å‚™",
                tasks: [
                    { text: "é ˜å–æ¯æ—¥ç™»å…¥çå‹µ", tag: "Game" },
                    { text: "å®Œæˆæ¯æ—¥ Arcane Symbol", tag: "Daily" },
                    { text: "æª¢æŸ¥å…¬æœƒæŠ€èƒ½å†·å»", tag: "Buff" }
                ]
            }
        ];

        // 2. ç‹€æ…‹ç®¡ç†
        let myTasks = JSON.parse(localStorage.getItem('myTasks')) || [];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            renderTasks();
            setupModal();
        });

        // 3. æ¸²æŸ“ç•«é¢
        function renderTasks() {
            const list = document.getElementById('task-list');
            const emptyState = document.getElementById('empty-state');
            
            list.innerHTML = ''; 

            if (myTasks.length === 0) {
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
                
                myTasks.forEach(task => {
                    const li = document.createElement('li');
                    // æ ¹æ“šæ˜¯å¦ç‚ºæŒ‘æˆ°ä»»å‹™çµ¦äºˆä¸åŒ class
                    li.className = `task-item ${task.completed ? 'completed' : ''} ${task.isChallenge ? 'is-challenge' : ''}`;
                    
                    li.innerHTML = `
                        <div style="display:flex; align-items:center; flex-grow:1;">
                            <input type="checkbox" 
                                style="transform: scale(1.2); cursor:pointer;"
                                ${task.completed ? 'checked' : ''} 
                                onchange="toggleTask('${task.id}')">
                            
                            <div class="task-content">
                                ${task.tag ? `<span class="tag">${task.tag}</span>` : ''}
                                <span>${task.text}</span>
                                ${task.challengeName ? `<div style="font-size:0.75rem; color:#999; margin-top:2px;">ä¾†è‡ª: ${task.challengeName}</div>` : ''}
                            </div>
                        </div>
                        
                        <button class="delete-btn" onclick="deleteTask('${task.id}')" title="åˆªé™¤ä»»å‹™">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    list.appendChild(li);
                });
            }
            
            updateProgress();
        }

        // 4. æ ¸å¿ƒï¼šæ¥å—æŒ‘æˆ°
        function activateChallenge(challengeId) {
            const selected = challenges.find(c => c.id === challengeId);
            if (!selected) return;

            // å°‡æŒ‘æˆ°å…§å®¹è¤‡è£½é€²ä»»å‹™åˆ—è¡¨
            const newTasks = selected.tasks.map(t => ({
                id: Date.now() + Math.random().toString(36).substr(2, 9),
                text: t.text,
                tag: t.tag,
                completed: false,
                isChallenge: true, // æ¨™è¨˜ç‚ºæŒ‘æˆ°ä»»å‹™
                challengeName: selected.title
            }));

            myTasks = [...myTasks, ...newTasks];
            save();
            renderTasks();
            closeModal();
            // ç°¡å–®çš„è¦–è¦ºå›é¥‹
            alert(`âš”ï¸ æŒ‘æˆ°é–‹å§‹ï¼š${selected.title}ï¼`);
        }

        // 5. CRUD æ“ä½œ
        function addManualTask() {
            const input = document.getElementById('new-task-input');
            const text = input.value.trim();
            if (!text) return;

            myTasks.push({
                id: Date.now().toString(),
                text: text,
                completed: false,
                isChallenge: false 
            });
            
            input.value = '';
            save();
            renderTasks();
        }

        function handleEnter(e) {
            if (e.key === 'Enter') addManualTask();
        }

        function toggleTask(id) {
            const task = myTasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                save();
                renderTasks();
            }
        }

        function deleteTask(id) {
            if(!confirm("ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ")) return;
            myTasks = myTasks.filter(t => t.id !== id);
            save();
            renderTasks();
        }

        function save() {
            localStorage.setItem('myTasks', JSON.stringify(myTasks));
        }

        // 6. é€²åº¦æ¢é‚è¼¯
        function updateProgress() {
            // åªè¨ˆç®—æŒ‘æˆ°ä»»å‹™
            const challengeTasks = myTasks.filter(t => t.isChallenge);
            const total = challengeTasks.length;
            const completed = challengeTasks.filter(t => t.completed).length;

            const label = document.getElementById('challenge-label');
            const percentText = document.getElementById('challenge-percent');
            const bar = document.getElementById('challenge-progress-bar');

            if (total === 0) {
                label.innerText = "ç›®å‰ç„¡é€²è¡Œä¸­çš„æŒ‘æˆ°";
                percentText.innerText = "0%";
                bar.style.width = "0%";
                bar.style.backgroundColor = "#e0e0e0";
            } else {
                const percent = Math.round((completed / total) * 100);
                label.innerText = `æŒ‘æˆ°é€²åº¦ (${completed}/${total})`;
                percentText.innerText = `${percent}%`;
                bar.style.width = `${percent}%`;
                
                if (percent === 100) {
                    bar.style.backgroundColor = "#ffbe5c"; // é‡‘è‰²
                } else {
                    bar.style.backgroundColor = "#4caf50"; // ç¶ è‰²
                }
            }
        }

        // 7. Modal æ§åˆ¶
        function setupModal() {
            const modal = document.getElementById('modal-overlay');
            const btn = document.getElementById('open-market-btn');
            const list = document.getElementById('challenge-list');

            btn.onclick = () => {
                modal.style.display = 'flex';
                list.innerHTML = challenges.map(c => `
                    <div class="challenge-card">
                        <div style="display:flex; justify-content:space-between; align-items:start;">
                            <div>
                                <h4>${c.title}</h4>
                                <div class="challenge-desc">${c.description}</div>
                                <div class="challenge-meta">
                                    <i class="fas fa-list-ul"></i> ${c.tasks.length} å€‹ä»»å‹™
                                </div>
                            </div>
                            <button class="btn secondary-btn" onclick="activateChallenge('${c.id}')">
                                æ¥å—
                            </button>
                        </div>
                    </div>
                `).join('');
            };
        }

        function closeModal() {
            document.getElementById('modal-overlay').style.display = 'none';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('modal-overlay');
            if (event.target == modal) closeModal();
        }
    </script>
</body>
</html>
